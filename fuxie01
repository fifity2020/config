# 1. åŸºç¡€è®¾ç½® 
allow-lan: false        # å…³é—­å±€åŸŸç½‘å…±äº«ï¼Œé˜²æ­¢ç«¯å£æš´éœ²
bind-address: "*"
tcp-concurrent: true
log-level: info
ipv6: false             # åŠå…¬ç½‘å»ºè®®å…³é—­ IPv6

# 2. DNS è®¾ç½® (åŠå…¬ç½‘æ ¸å¿ƒ)
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  respect-rules: true
  
  # === Fake-IP è¿‡æ»¤ (è¿”å›çœŸå®IP) ===
  fake-ip-filter:
    - '+.lan'
    - '+.local'
    - '+.internal'
    - 'oa.corp.com'       # å…¬å¸å†…ç½‘åŸŸå
    - '*.msftncsi.com'    # Windows è¿é€šæ€§æ£€æµ‹
    - 'msftconnecttest.com'
    - '+.stun.*'          # WebRTC/è¯­éŸ³é€šè¯
  
  # é»˜è®¤ DNS (ç”¨äºè§£æå›½å†…åŸŸå)
  default-nameserver:
    - system              # ã€å…³é”®ã€‘ä¼˜å…ˆè¯¢é—®ç³»ç»ŸDNSï¼Œè§£å†³å†…ç½‘è§£æ
    - 223.5.5.5
    - 119.29.29.29

  # ä¸»è¦ DNS 
  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
    # ç§»é™¤ systemï¼Œé˜²æ­¢å…¬ç½‘æŸ¥è¯¢å›è½å¯¼è‡´æ±¡æŸ“ï¼Œå†…ç½‘ç”± policy ä¸“ç®¡

  # === æ ¸å¿ƒç­–ç•¥: DNS åˆ†æµ (Nameserver Policy) ===
  # è¿™ä¸€æ­¥å†³å®šäº†å†…ç½‘ç¨³ä¸ç¨³
  nameserver-policy:
    # 1. å…¬å¸å†…ç½‘ -> å¼ºåˆ¶èµ°ç³»ç»Ÿ DNS (ç»ä¸å‘ç»™é˜¿é‡Œ)
    "oa.corp.com": system
    "+.corp.com": system   # å‡è®¾ä½ å…¬å¸åŸŸååç¼€æ˜¯ corp.com
    "+.internal": system
    
    # 2. Windows è¿é€šæ€§æ£€æµ‹ -> èµ°ç³»ç»Ÿ DNS
    "*.msftncsi.com": system
    "*.msftconnecttest.com": system
    
    # 3. å›½å¤–å¸¸è§å¤§å‚ -> é˜¿é‡Œ/è…¾è®¯ DoH (åŠ å¿«è§£æ)
    "geosite:cn,private,apple,microsoft":
      - https://dns.alidns.com/dns-query
      - https://doh.pub/dns-query

  # å¤‡ç”¨/å›½å¤– DNS
  fallback:
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
  
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4

# 3. åŸŸåå—…æ¢
sniffer:
  enable: true
  parse-pure-ip: true     # å¼€å¯å¯¹çº¯ IP çš„å—…æ¢
  sniff:
    HTTP: { ports: [80, 8080-8880], override-destination: true }
    TLS: { ports: [443, 8443] }
    QUIC: { ports: [443, 8443] }
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

# 4. è§„åˆ™é›†å®šä¹‰
rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: mrs}
  class: &class {type: http, interval: 86400, behavior: classical, format: text}

rule-providers:
  reject_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/category-ads-all.mrs"}
  ai_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/category-ai-!cn.mrs" }
  youtube_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.mrs"}
  google_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.mrs"}
  github_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.mrs"}
  telegram_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.mrs"}
  netflix_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/netflix.mrs"}
  microsoft_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.mrs"}
  apple_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/apple.mrs"}
  tiktok_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/tiktok.mrs"}
  geolocation-!cn: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.mrs"}
  cn_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs"}
  cn_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs"}
  telegram_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.mrs"}

# 5. ç­–ç•¥ç»„
proxy-groups:
  # ==============================
  # 1. æ ¸å¿ƒæ§åˆ¶ç»„ (Main Control)
  # ==============================
  # ä¸»å…¥å£ï¼šå¹³æ—¶å»ºè®®é€‰â€œâš¡ å…¨å±€è‡ªåŠ¨ä¼˜é€‰â€ï¼Œéœ€è¦ç‰¹å®šåœ°åŒºæ—¶æ‰‹åŠ¨åˆ‡
  - { name: ğŸš€ ä¸»ä»£ç†ç»„, type: select, proxies: [âš¡ å…¨å±€è‡ªåŠ¨ä¼˜é€‰, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, DIRECT] }

  # è‡ªåŠ¨ä¼˜é€‰ï¼šæ’é™¤å®˜ç½‘ã€å‰©ä½™æµé‡ç­‰æ— æ•ˆèŠ‚ç‚¹ï¼Œå¹¶åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸­é€‰æœ€å¿«çš„
  - { name: âš¡ å…¨å±€è‡ªåŠ¨ä¼˜é€‰, type: url-test, include-all: true, filter: "^(?!.*(å‰©ä½™|åˆ°æœŸ|å®˜ç½‘|è¿‡æœŸ|Traffic|Website|Reset)).*", url: "http://www.gstatic.com/generate_204", interval: 300, tolerance: 50}

  # ==============================
  # 2. åœ°åŒºè‡ªåŠ¨ç»„ (Region Auto)
  # ==============================
  # é€»è¾‘ï¼šè‡ªåŠ¨æŠ“å–å¯¹åº”åœ°åŒºèŠ‚ç‚¹ï¼Œå¹¶é€‰å‡ºæœ€å¿«çš„ä¸€ä¸ª
  - { name: ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, type: url-test, include-all: true, filter: "(?i)HK|é¦™æ¸¯|HongKong", interval: 300, tolerance: 50, lazy: true}
  - { name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, type: url-test, include-all: true, filter: "(?i)JP|æ—¥æœ¬|Japan", interval: 300, tolerance: 50, lazy: true}
  - { name: ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, type: url-test, include-all: true, filter: "(?i)SG|æ–°åŠ å¡|Singapore", interval: 300, tolerance: 50, lazy: true}
  - { name: ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, type: url-test, include-all: true, filter: "(?i)US|ç¾å›½|United States", interval: 300, tolerance: 50, lazy: true}

  # ==============================
  # 3. åº”ç”¨ç­–ç•¥ç»„ (Applications)
  # ==============================
  # AI æœåŠ¡ï¼šæ¨èä¼˜å…ˆèµ°ç¾å›½æˆ–æ—¥æœ¬ï¼Œæ›´ç¨³å®š
  - { name: ğŸ¤– AI, type: select, proxies: [ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸš€ ä¸»ä»£ç†ç»„] }

  # æµåª’ä½“
  - { name: ğŸ“º YouTube, type: select, proxies: [ğŸš€ ä¸»ä»£ç†ç»„, âš¡ å…¨å±€è‡ªåŠ¨ä¼˜é€‰] }
  - { name: ğŸ¥ NETFLIX, type: select, proxies: [ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸš€ ä¸»ä»£ç†ç»„] }

  # ã€æ–°å¢ã€‘Telegramï¼šç”±äºå¿…é¡»èµ°ä»£ç†ï¼Œé»˜è®¤æŒ‡å‘ä¸»ä»£ç†ç»„
  - { name: ğŸ“² Telegram, type: select, proxies: [ğŸš€ ä¸»ä»£ç†ç»„, âš¡ å…¨å±€è‡ªåŠ¨ä¼˜é€‰] }

  # ã€æ–°å¢ã€‘Apple æœåŠ¡ï¼šé»˜è®¤ç›´è¿ (DIRECT)ï¼ŒåŠ é€Ÿ App Store å’Œç³»ç»Ÿæ›´æ–°
  - { name: ğŸ Apple, type: select, proxies: [DIRECT, ğŸš€ ä¸»ä»£ç†ç»„] }

  # ã€æ–°å¢ã€‘å¾®è½¯æœåŠ¡ï¼šé»˜è®¤ç›´è¿ (DIRECT)ï¼Œé˜²æ­¢ Outlook/Teams è¯¯æŠ¥å¼‚åœ°ç™»å½•æˆ–å¡é¡¿
  - { name: ğŸªŸ Microsoft, type: select, proxies: [DIRECT, ğŸš€ ä¸»ä»£ç†ç»„] }

  # ==============================
  # 4. åŠŸèƒ½ä¸å…œåº• (Utility & Final)
  # ==============================
  # ã€æ–°å¢ã€‘å¹¿å‘Šæ‹¦æˆªï¼šé»˜è®¤æ‹’ç» (REJECT)ï¼Œå¦‚æœæƒ³ä¸´æ—¶å…³æ‰æ‹¦æˆªï¼Œå¯æ‰‹åŠ¨é€‰ DIRECT
  - { name: å¹¿å‘Šæ‹¦æˆª, type: select, proxies: [REJECT, DIRECT] }

  # æ²¡æœ‰å‘½ä¸­è§„åˆ™çš„æµé‡ï¼Œé»˜è®¤èµ°ä»£ç†
  - { name: ğŸŸ æ¼ç½‘ä¹‹é±¼, type: select, proxies: [ğŸš€ ä¸»ä»£ç†ç»„, DIRECT] }

# 6. è§„åˆ™
rules:
  # æ‹¦æˆªå¹¿å‘Š
  - RULE-SET,reject_domain,å¹¿å‘Šæ‹¦æˆª
  
  # è§£å†³ YouTube é™é€Ÿ (QUIC é™çº§ TCP)
  - AND,((NETWORK,UDP),(DST-PORT,443),(DOMAIN-KEYWORD,googlevideo)),REJECT
  
  # ç‰¹æ®Šåº”ç”¨åˆ†æµ
  - RULE-SET,ai_domain,ğŸ¤– AI
  - RULE-SET,youtube_domain,ğŸ“º YouTube
  - RULE-SET,netflix_domain,ğŸ¥ NETFLIX
  - RULE-SET,telegram_domain,ğŸ“² Telegram
  - RULE-SET,telegram_ip,ğŸ“² Telegram
  
  # ç³»ç»Ÿ/ç”Ÿäº§åŠ› (ä¼˜å…ˆç›´è¿ï¼Œå¯é€‰ä»£ç†)
  - RULE-SET,apple_domain,ğŸ Apple
  - RULE-SET,github_domain,ğŸš€ ä¸»ä»£ç†ç»„
  - RULE-SET,microsoft_domain,ğŸªŸ Microsoft
  
  
  # å›½å†…ç›´è¿
  - RULE-SET,cn_domain,DIRECT
  - RULE-SET,cn_ip,DIRECT,no-resolve
  - GEOIP,LAN,DIRECT,no-resolve
  - GEOIP,CN,DIRECT,no-resolve

  # å…œåº•
  - RULE-SET,geolocation-!cn,ğŸš€ ä¸»ä»£ç†ç»„
  - MATCH, ğŸŸ æ¼ç½‘ä¹‹é±¼
